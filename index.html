<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»¿æ ‘åº”ç”¨ä¸­å¿ƒ</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://fastly.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="icon" href="logo.ico" />
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="gradient-navbar">
        <div class="container">
            <h1>ç»¿æ ‘åº”ç”¨ä¸­å¿ƒ</h1>
            <!-- æ·»åŠ ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
            <div class="nav-menu">
                <a href="https://lvshu-is-666.github.io/App/" class="nav-link">é¦–é¡µ</a>
                <a href="https://lvshu-is-666.github.io/App/about" class="nav-link">å…³äº</a>
                <button class="theme-toggle-btn" onclick="toggleTheme()">
                    <span class="light-icon">â˜€ï¸</span>
                    <span class="dark-icon">ğŸŒ™</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="gradient-background">
        <div class="container">
            <!-- æœç´¢æ¡† -->
            <div class="search-container">
                <input type="text" id="search-input" placeholder="æœç´¢åº”ç”¨...">
                <!--<button class="search-btn"><i class="fas fa-search"></i></button>-->
            </div>

            <div id="app-list" class="app-grid"></div>
            <div id="app-detail-container" style="display: none;">
                <button class="gradient-back-btn" onclick="showList()">â† è¿”å›åˆ—è¡¨</button>
                <div id="app-detail"></div>
            </div>
        </div>
    </main>

    <script>
        // è°ƒè¯•ç”¨åˆå§‹åŒ–æç¤º
        console.log("åˆå§‹åŒ–å¼€å§‹...");
        
        const apps = [
    {
        id: 1,
        name: "Lvshu OS",
        brief: "é«˜æ•ˆçš„lvshuæ“ä½œç³»ç»Ÿ",  // æ–°å¢ç®€çŸ­æè¿°
        version: "7.0.3",
        download: "apps/Lvshu OS.exe",
        icon: "icon/Lvshu OS.png",
        detail: "details/Lvshu OS.md",      // è¯¦ç»†æè¿°æ–‡ä»¶
        changelog: "md/Lvshu OS.md"         // æ›´æ–°æ—¥å¿—æ–‡ä»¶
    },
    {
        id: 2,
        name: "ç»¿æ ‘äº‘å­˜å‚¨",
        brief: "é«˜æ•ˆçš„ä¼ä¸šçº§åŠå…¬è§£å†³æ–¹æ¡ˆ",  // æ–°å¢ç®€çŸ­æè¿°
        version: "1.4.3",
        download: "#",
        icon: "icon/cloud.png",
        description: "details/cloud.md",  // æ”¹ä¸ºMarkdownæ–‡ä»¶è·¯å¾„
        changelog: "md/cloud.md"
    }
];

        // å¢å¼ºçš„é”™è¯¯å¤„ç†
        function initAppList() {
            try {
                console.log("æ­£åœ¨åˆå§‹åŒ–åº”ç”¨åˆ—è¡¨...");
                const container = document.getElementById('app-list');
                if (!container) throw new Error('æ‰¾ä¸åˆ°åˆ—è¡¨å®¹å™¨å…ƒç´ ');
                
                container.innerHTML = apps.map(app => `
        <div class="app-card" onclick="showDetail(${app.id})">
            <img src="${app.icon}" class="app-icon" alt="${app.name}å›¾æ ‡">
            <div class="app-card-content">
                <h2>${app.name}</h2>
                <p class="app-brief">${app.brief}</p>  <!-- æ˜¾ç¤ºç®€çŸ­æè¿° -->
                <small>å½“å‰ç‰ˆæœ¬: ${app.version}</small>
            </div>
        </div>
    `).join('');
                
                console.log("åº”ç”¨åˆ—è¡¨åˆå§‹åŒ–å®Œæˆ");
                
                // åˆå§‹åŒ–æœç´¢åŠŸèƒ½
                const searchInput = document.getElementById('search-input');
                searchInput.addEventListener('input', debounce(handleSearch, 300));
            } catch (error) {
                console.error("åˆå§‹åŒ–å¤±è´¥:", error);
                document.body.innerHTML = `<h2 style="color:red">åˆå§‹åŒ–é”™è¯¯: ${error.message}</h2>`;
            }
        }

async function showDetail(appId) {
    const app = apps.find(a => a.id === appId);
    const container = document.getElementById('app-detail');
    
    // åˆ›å»ºMarkdownå†…å®¹åŠ è½½å™¨
    async function loadFile(file) {
        const response = await fetch(file);
        if (!response.ok) throw new Error('æ–‡ä»¶åŠ è½½å¤±è´¥');
        return await response.text();
    }

    container.innerHTML = `
    <div class="app-detail">
        <div class="detail-container">
            <!-- å·¦ä¾§å†…å®¹åŒº -->
            <div class="detail-main">
                        <h1>${app.name}</h1>
                        
                        <!-- æ–°æ·»åŠ çš„ Markdown å®¹å™¨ -->
                        <div class="markdown-container">
                            <div class="description-container">
                                <h2>åº”ç”¨ä»‹ç»</h2>
                                <div class="loading-description">åŠ è½½è¯¦ç»†å†…å®¹ä¸­...</div>
                                <div id="description-content"></div>
                            </div>
                            
                            <div class="changelog-container">
                                <h2>æ›´æ–°æ—¥å¿—</h2>
                                <div class="loading-changelog">åŠ è½½æ›´æ–°æ—¥å¿—ä¸­...</div>
                                <div id="changelog-content"></div>
                            </div>
                        </div>
                    </div>

            <!-- å³ä¾§ä¾§è¾¹æ  -->
            <div class="detail-sidebar">
                <img src="${app.icon}" 
                     class="detail-icon" 
                     alt="${app.name}å›¾æ ‡">
                <button class="download-btn" 
                        onclick="location.href='${app.download}'">
                    ä¸‹è½½ v${app.version}
                </button>
            </div>
        </div>
    </div>`;

    try {
        const [descMD, changelogMD] = await Promise.all([
            loadFile(app.description || app.detail),
            loadFile(app.changelog || app.changelogs)
        ]);

        // æ¸²æŸ“åº”ç”¨ä»‹ç»
        document.getElementById('description-content').innerHTML = marked.parse(descMD);
        document.querySelector('.loading-description').style.display = 'none';
        document.getElementById('description-content').style.display = 'block';

        // æ¸²æŸ“æ›´æ–°æ—¥å¿—
        document.getElementById('changelog-content').innerHTML = marked.parse(changelogMD);
        document.querySelector('.loading-changelog').style.display = 'none';
        document.getElementById('changelog-content').style.display = 'block';

    } catch (error) {
        document.querySelector('.loading-description').innerHTML = 
            `<div class="error">å†…å®¹åŠ è½½å¤±è´¥ï¼š${error.message}</div>`;
        document.querySelector('.loading-changelog').innerHTML = 
            `<div class="error">æ—¥å¿—åŠ è½½å¤±è´¥ï¼š${error.message}</div>`;
    }

    document.getElementById('app-list').style.display = 'none';
    document.getElementById('app-detail-container').style.display = 'block';
}

        // æ˜¾ç¤ºåˆ—è¡¨
        function showList() {
            document.getElementById('app-list').style.display = 'grid';
            document.getElementById('app-detail-container').style.display = 'none';
        }

        // å¯åŠ¨åˆå§‹åŒ–
        window.onload = initAppList;
        console.log("è„šæœ¬åŠ è½½å®Œæˆ");

        // æ·»åŠ æœç´¢åŠŸèƒ½
        function handleSearch() {
            const search = document.getElementById('search-input').value.toLowerCase();
            const container = document.getElementById('app-list');
            
            const filteredApps = apps.filter(app => app.name.toLowerCase().includes(search));
            container.innerHTML = filteredApps.map(app => `
        <div class="app-card" onclick="showDetail(${app.id})">
            <img src="${app.icon}" class="app-icon" alt="${app.name}å›¾æ ‡">
            <div class="app-card-content">
                <h2>${app.name}</h2>
                <p class="app-brief">${app.brief}</p>
                <small>å½“å‰ç‰ˆæœ¬: ${app.version}</small>
            </div>
        </div>
    `).join('');
        }

        // é˜²æŠ–åŠŸèƒ½
        function debounce(fn, delay) {
            let timeout;
            return (...args) => {
                clearTimeout(timeout);
                timeout = setTimeout(() => fn.apply(this, args), delay);
            };
        }

        // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        function toggleTheme() {
            const darkThemeKey = 'prefers-color-scheme';
            const root = document.documentElement;
            const currentTheme = (root.style.getPropertyValue('--current-theme') || '').trim();
            
            if (currentTheme === 'dark') {
                // åˆ‡æ¢åˆ°é»˜è®¤ä¸»é¢˜
                root.style.removeProperty('--current-theme');
                document.querySelectorAll('.theme-toggle-btn .light-icon').forEach(e => e.style.display = 'inline');
                document.querySelectorAll('.theme-toggle-btn .dark-icon').forEach(e => e.style.display = 'none');
                localStorage.removeItem('appTheme');
            } else {
                // æ ¹æ®ç”¨æˆ·è®¾ç½®åˆ‡æ¢
                const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                const newTheme = localStorage.getItem('appTheme') || (systemPrefersDark ? 'dark' : 'light');
                
                // ä½¿ç”¨ç³»ç»Ÿåå¥½
                if (newTheme === 'dark') {
                    root.style.setProperty('--current-theme', 'dark');
                    document.querySelectorAll('.theme-toggle-btn .light-icon').forEach(e => e.style.display = 'none');
                    document.querySelectorAll('.theme-toggle-btn .dark-icon').forEach(e => e.style.display = 'inline');
                    localStorage.setItem('appTheme', 'dark');
                } else {
                    // å¤ä½ä¸»é¢˜
                    root.style.removeProperty('--current-theme');
                    document.querySelectorAll('.theme-toggle-btn .light-icon').forEach(e => e.style.display = 'inline');
                    document.querySelectorAll('.theme-toggle-btn .dark-icon').forEach(e => e.style.display = 'none');
                    localStorage.removeItem('appTheme');
                }
            }
        }

        // åˆå§‹åŒ–ä¸»é¢˜
        function initTheme() {
            const storedTheme = localStorage.getItem('appTheme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            let currentTheme = storedTheme || (systemPrefersDark ? 'dark' : 'light');
            document.documentElement.style.setProperty('--current-theme', currentTheme);
            
            // æ ¹æ®ä¸»é¢˜æ˜¾ç¤ºå›¾æ ‡
            if (currentTheme === 'dark') {
                document.querySelectorAll('.theme-toggle-btn .light-icon').forEach(e => e.style.display = 'none');
                document.querySelectorAll('.theme-toggle-btn .dark-icon').forEach(e => e.style.display = 'inline');
            } else {
                document.querySelectorAll('.theme-toggle-btn .dark-icon').forEach(e => e.style.display = 'none');
                document.querySelectorAll('.theme-toggle-btn .light-icon').forEach(e => e.style.display = 'inline');
            }
        }

        window.onload = () => {
            initAppList();
            initTheme(); // åˆå§‹åŒ–ä¸»é¢˜
        };
    </script>
</body>
</html>
