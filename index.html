<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç»¿æ ‘åº”ç”¨ä¸­å¿ƒ</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://fastly.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <link rel="icon" href="logo.ico" />
</head>
<body>
    <!-- å¯¼èˆªæ  -->
    <nav class="gradient-navbar">
        <div class="container">
            <h1>ç»¿æ ‘åº”ç”¨ä¸­å¿ƒ</h1>
            <!-- æ·»åŠ ä¸»é¢˜åˆ‡æ¢æŒ‰é’® -->
            <div class="nav-menu">
                <a href="https://lvshu-is-666.github.io/App/" class="nav-link">é¦–é¡µ</a>
                <a href="https://lvshu-is-666.github.io/App/about" class="nav-link">å…³äº</a>
                <button class="theme-toggle-btn" onclick="toggleTheme()">
                    <span class="light-icon">â˜€ï¸</span>
                    <span class="dark-icon">ğŸŒ™</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="gradient-background">
        <div class="container">
            <!-- æœç´¢æ¡† -->
            <div class="search-container">
                <input type="text" id="search-input" placeholder="æœç´¢åº”ç”¨...">
                <!--<button class="search-btn"><i class="fas fa-search"></i></button>-->
            </div>

            <div id="app-list" class="app-grid"></div>
            <div id="app-detail-container" style="display: none;">
                <button class="gradient-back-btn" onclick="showList()"><i class="fa-solid fa-arrow-left"></i>è¿”å›åˆ—è¡¨</button>
                <div id="app-detail"></div>
            </div>
        </div>
    </main>

    <script>
        // è°ƒè¯•ç”¨åˆå§‹åŒ–æç¤º
        console.log("åˆå§‹åŒ–å¼€å§‹...");
        
        const apps = [
            {
                id: 1001,
                name: "Lvshu OS",
                brief: "ç»¿æ ‘å…¬å¸æ“ä½œç³»ç»Ÿ",
                version: "7.0.3",
                download: "apps/Lvshu OS.exe",
                icon: "icon/Lvshu OS.png",
                detail: "details/Lvshu OS.md",
                changelog: "log/Lvshu OS.md"
            },
            {
                id: 1002,
                name: "è°œä¹‹å·¥å…·ç®±",
                brief: "ä½ æƒ³è¦çš„å·¥å…·è¿™é‡Œéƒ½æœ‰",
                version: "3.6.0",
                download: "å¾®ä¿¡å°ç¨‹åº",
                icon: "icon/è°œä¹‹å·¥å…·ç®±.png",
                description: "details/è°œä¹‹å·¥å…·ç®±.md",
                changelog: "log/è°œä¹‹å·¥å…·ç®±.md"
            },
            {
                id: 1003,
                name: "ä¿„ç½—æ–¯æ–¹å—3",
                brief: "ä½ èƒ½æ‰“åˆ°4000åˆ†ä»¥ä¸Šå—ï¼Ÿ",
                version: "3.0.1",
                download: "apps/ä¿„ç½—æ–¯æ–¹å—3.exe",
                icon: "icon/ä¿„ç½—æ–¯æ–¹å—.png",
                description: "details/ä¿„ç½—æ–¯æ–¹å—.md",
                changelog: "log/ä¿„ç½—æ–¯æ–¹å—.md"
            },
            {
                id: 2001,
                name: "deepseek",
                brief: "DeepSeek - æ¢ç´¢æœªè‡³ä¹‹å¢ƒ",
                version: "V3 / R1",
                download: "https://chat.deepseek.com/",
                icon: "icon/deepseek.svg",
                description: "details/deepseek.md",
                changelog: "log/deepseek.md"
            },
            {
                id: 2002,
                name: "æ–‡å¿ƒä¸€è¨€",
                brief: "æ–‡å¿ƒä¸€è¨€ï¼Œä½ çš„æ™ºèƒ½ä¼™ä¼´\næœ‰ç”¨ã€æœ‰è¶£ã€æœ‰æ¸©åº¦",
                version: "3.5 / 4.0",
                download: "https://yiyan.baidu.com/",
                icon: "icon/æ–‡å¿ƒä¸€è¨€.png",
                description: "details/æ–‡å¿ƒä¸€è¨€.md",
                changelog: "log/æ–‡å¿ƒä¸€è¨€.md"
            },
            {
                id: 2003,
                name: "Kimi",
                brief: "Kimi.ai - ä¼šæ¨ç†è§£æï¼Œèƒ½æ·±åº¦æ€è€ƒçš„AIåŠ©æ‰‹",
                version: "k1.5 é•¿æ€è€ƒ",
                download: "https://kimi.moonshot.cn/",
                icon: "icon/Kimi.png",
                description: "details/Kimi.md",
                changelog: "log/Kimi.md"
            }
        ];

        // å¢å¼ºçš„é”™è¯¯å¤„ç†
        function initAppList() {
            try {
                console.log("æ­£åœ¨åˆå§‹åŒ–åº”ç”¨åˆ—è¡¨...");
                const container = document.getElementById('app-list');
                if (!container) throw new Error('æ‰¾ä¸åˆ°åˆ—è¡¨å®¹å™¨å…ƒç´ ');
                
                container.innerHTML = apps.map(app => `
        <div class="app-card" onclick="showDetail(${app.id})">
            <img src="${app.icon}" class="app-icon" alt="${app.name}å›¾æ ‡">
            <div class="app-card-content">
                <h2>${app.name}</h2>
                <p class="app-brief">${app.brief}</p>  <!-- æ˜¾ç¤ºç®€çŸ­æè¿° -->
                <small>å½“å‰ç‰ˆæœ¬: ${app.version}</small>
            </div>
        </div>
    `).join('');
                
                console.log("åº”ç”¨åˆ—è¡¨åˆå§‹åŒ–å®Œæˆ");
                
                // åˆå§‹åŒ–æœç´¢åŠŸèƒ½
                const searchInput = document.getElementById('search-input');
                searchInput.addEventListener('input', debounce(handleSearch, 300));
            } catch (error) {
                console.error("åˆå§‹åŒ–å¤±è´¥:", error);
                document.body.innerHTML = `<h2 style="color:red">åˆå§‹åŒ–é”™è¯¯: ${error.message}</h2>`;
            }
        }

async function showDetail(appId) {
    const app = apps.find(a => a.id === appId);
    const container = document.getElementById('app-detail');

    document.querySelector('.search-container').style.display = 'none';
    
    // åˆ›å»ºMarkdownå†…å®¹åŠ è½½å™¨
    async function loadFile(file) {
        const response = await fetch(file);
        if (!response.ok) throw new Error('æ–‡ä»¶åŠ è½½å¤±è´¥');
        return await response.text();
    }

    container.innerHTML = `
    <div class="app-detail">
        <div class="detail-container">
            <!-- å·¦ä¾§å†…å®¹åŒº -->
            <div class="detail-main">
                        <h1>${app.name}</h1>
                        <!-- åˆ†äº«æŒ‰é’® -->
            <div class="share-container">
                <button class="share-btn" onclick="copyShareLink(${app.id})">
                    <i class="fas fa-share-alt"></i> åˆ†äº«
                </button>
            </div>
                            <div class="description-container">
                                <div class="loading-description">åŠ è½½è¯¦ç»†å†…å®¹ä¸­...</div>
                                <div id="description-content"></div>
                            </div>
                            
                            <div class="changelog-container">
                                <h2>æ›´æ–°æ—¥å¿—</h2>
                                <div class="loading-changelog">åŠ è½½æ›´æ–°æ—¥å¿—ä¸­...</div>
                                <div id="changelog-content"></div>
                            </div>
                    </div>

            <!-- å³ä¾§ä¾§è¾¹æ  -->
            <div class="detail-sidebar">
                <img src="${app.icon}" 
                     class="detail-icon" 
                     alt="${app.name}å›¾æ ‡">
                <button class="download-btn" 
                        onclick="location.href='${app.download}'">
                    <i class="fa-solid fa-download"></i> ä¸‹è½½ ${app.version} ç‰ˆæœ¬
                </button>
            </div>
        </div>
    </div>`;
    
    try {
        const [descMD, changelogMD] = await Promise.all([
            loadFile(app.description || app.detail),
            loadFile(app.changelog || app.changelogs)
        ]);

        // æ¸²æŸ“åº”ç”¨ä»‹ç»
        document.getElementById('description-content').innerHTML = marked.parse(descMD);
        document.querySelector('.loading-description').style.display = 'none';
        document.getElementById('description-content').style.display = 'block';

        // æ¸²æŸ“æ›´æ–°æ—¥å¿—
        document.getElementById('changelog-content').innerHTML = marked.parse(changelogMD);
        document.querySelector('.loading-changelog').style.display = 'none';
        document.getElementById('changelog-content').style.display = 'block';

    } catch (error) {
        document.querySelector('.loading-description').innerHTML = 
            `<div class="error">å†…å®¹åŠ è½½å¤±è´¥ï¼š${error.message}</div>`;
        document.querySelector('.loading-changelog').innerHTML = 
            `<div class="error">æ—¥å¿—åŠ è½½å¤±è´¥ï¼š${error.message}</div>`;
    }

    document.getElementById('app-list').style.display = 'none';
    document.getElementById('app-detail-container').style.display = 'block';
}

        // å¤åˆ¶åˆ†äº«é“¾æ¥
function copyShareLink(appId) {
    const baseUrl = window.location.origin + window.location.pathname;
    const shareUrl = `${baseUrl}?appId=${appId}`;

    // Copy to clipboard
    navigator.clipboard.writeText(shareUrl)
        .then(() => {
            alert(`å·²å¤åˆ¶åˆ†äº«é“¾æ¥ï¼š${shareUrl}`);
        })
        .catch(err => {
            console.error('å¤åˆ¶å¤±è´¥:', err);
            alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶ä»¥ä¸‹é“¾æ¥ï¼š' + shareUrl);
        });
}

        // æ˜¾ç¤ºåˆ—è¡¨
        function showList() {
            document.querySelector('.search-container').style.display = 'flex';
            
            document.getElementById('app-list').style.display = 'grid';
            document.getElementById('app-detail-container').style.display = 'none';
        }

        // å¯åŠ¨åˆå§‹åŒ–
        window.onload = () => {
            initAppList();
            initTheme(); // åˆå§‹åŒ–ä¸»é¢˜
            parseUrlParams(); // åˆå§‹åŒ–æ—¶è§£æ URL å‚æ•°
        };
        console.log("è„šæœ¬åŠ è½½å®Œæˆ");

        // æ·»åŠ æœç´¢åŠŸèƒ½
        function handleSearch() {
            const search = document.getElementById('search-input').value.toLowerCase();
            const container = document.getElementById('app-list');
            
            const filteredApps = apps.filter(app => app.name.toLowerCase().includes(search));
            container.innerHTML = filteredApps.map(app => `
        <div class="app-card" onclick="showDetail(${app.id})">
            <img src="${app.icon}" class="app-icon" alt="${app.name}å›¾æ ‡">
            <div class="app-card-content">
                <h2>${app.name}</h2>
                <p class="app-brief">${app.brief}</p>
                <small>å½“å‰ç‰ˆæœ¬: ${app.version}</small>
            </div>
        </div>
    `).join('');
        }

        // é˜²æŠ–åŠŸèƒ½
        function debounce(fn, delay) {
            let timeout;
            return (...args) => {
                clearTimeout(timeout);
                timeout = setTimeout(() => fn.apply(this, args), delay);
            };
        }

        // ä¸»é¢˜åˆ‡æ¢åŠŸèƒ½
        function toggleTheme() {
            const darkThemeKey = 'prefers-color-scheme';
            const root = document.documentElement;
            const currentTheme = (root.style.getPropertyValue('--current-theme') || '').trim();
            
            if (currentTheme === 'dark') {
                // åˆ‡æ¢åˆ°é»˜è®¤ä¸»é¢˜
                root.style.removeProperty('--current-theme');
                document.querySelectorAll('.theme-toggle-btn .light-icon').forEach(e => e.style.display = 'inline');
                document.querySelectorAll('.theme-toggle-btn .dark-icon').forEach(e => e.style.display = 'none');
                localStorage.removeItem('appTheme');
            } else {
                // æ ¹æ®ç”¨æˆ·è®¾ç½®åˆ‡æ¢
                const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                const newTheme = localStorage.getItem('appTheme') || (systemPrefersDark ? 'dark' : 'light');
                
                // ä½¿ç”¨ç³»ç»Ÿåå¥½
                if (newTheme === 'dark') {
                    root.style.setProperty('--current-theme', 'dark');
                    document.querySelectorAll('.theme-toggle-btn .light-icon').forEach(e => e.style.display = 'none');
                    document.querySelectorAll('.theme-toggle-btn .dark-icon').forEach(e => e.style.display = 'inline');
                    localStorage.setItem('appTheme', 'dark');
                } else {
                    // å¤ä½ä¸»é¢˜
                    root.style.removeProperty('--current-theme');
                    document.querySelectorAll('.theme-toggle-btn .light-icon').forEach(e => e.style.display = 'inline');
                    document.querySelectorAll('.theme-toggle-btn .dark-icon').forEach(e => e.style.display = 'none');
                    localStorage.removeItem('appTheme');
                }
            }
        }

        // åˆå§‹åŒ–ä¸»é¢˜
        function initTheme() {
            const storedTheme = localStorage.getItem('appTheme');
            const systemPrefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            let currentTheme = storedTheme || (systemPrefersDark ? 'dark' : 'light');
            document.documentElement.style.setProperty('--current-theme', currentTheme);
            
            // æ ¹æ®ä¸»é¢˜æ˜¾ç¤ºå›¾æ ‡
            if (currentTheme === 'dark') {
                document.querySelectorAll('.theme-toggle-btn .light-icon').forEach(e => e.style.display = 'none');
                document.querySelectorAll('.theme-toggle-btn .dark-icon').forEach(e => e.style.display = 'inline');
            } else {
                document.querySelectorAll('.theme-toggle-btn .dark-icon').forEach(e => e.style.display = 'none');
                document.querySelectorAll('.theme-toggle-btn .light-icon').forEach(e => e.style.display = 'inline');
            }
        }

        // è§£æ URL å‚æ•°
        function parseUrlParams() {
            const params = new URLSearchParams(window.location.search);
            const appId = params.get('appId');
            
            if (appId) {
                console.log("ä» URL ä¸­è§£æåˆ° appId:", appId);
                
                // æ˜¾ç¤ºåº”ç”¨è¯¦æƒ…é¡µ
                showDetail(parseInt(appId));
                document.getElementById('app-list').style.display = 'none';
                document.getElementById('app-detail-container').style.display = 'block';
            }
        }
    </script>
</body>
</html>
